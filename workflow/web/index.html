<html>
  <head>
    <title>SignalR Connection</title>
    <style type="text/css" rel="stylesheet">
      .message {
        border: solid 1px black;
        padding: 20px;
        font-weight: bold;

        margin-top: 10px;
      }

      .connected {
        background-color: yellowgreen;
      }

      .signal-success {
        background-color: #77dd77;
      }

      .signal-warning {
        background-color: pink;
      }
    </style>
  </head>

  <body>
    <h3>Messages</h3>
    <hr />
    <div id="messages-container">
    </div>

    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@3.1.3/dist/browser/signalr.min.js"></script>
    <script>
      $(function() {
        const apiBaseUrl = 'https://func-workflow-app-jx01.azurewebsites.net'

        const connection = new signalR.HubConnectionBuilder()
          .withUrl(`${apiBaseUrl}/api`)
          .withAutomaticReconnect()
          .build();

        connection.on('signalSend', function (signal) {
          let blobName = signal.BlobName;
          if (signal.Level == "Success") {
            let lookupLocation = apiBaseUrl + signal.Data.lookupLocation;

            $("#messages-container").prepend(`<div class="message signal-success">
              <div>Image Process successfully</div>
              <div>See results: <a href="${lookupLocation}">${blobName}</a></div>
            </div>`);
          }

          if (signal.Level == "Warning") {
            $("#messages-container").prepend(`<div class="message signal-warning">Warning Signal received from server: ${signal}</div>`);
          } 
        });

        connection.start().then(function() {
          $("#messages-container").prepend(`<div class="message connected">Connected to SignalR Hub</div>`);
        }).catch(function(err) {
          return console.error(err.toString());
        });
      });
    </script>
  </body>
</html>